ë¸”ë¡œê·¸ ìë£Œ ì£¼ì†Œ
https://blog.orange.tw/posts/2024-08-confusion-attacks-en/
https://i.blackhat.com/BH-US-24/Presentations/US24-Orange-Confusion-Attacks-Exploiting-Hidden-Semantic-Thursday.pdf

ğŸ‘‰ ì˜ˆì‹œ ì‚¬ìš©ì: admin / password
ğŸ‘‰ ì•„ë˜ í•´ì‹œëŠ” htpasswd -nbB admin password ë¡œ ìƒì„±í•œ bcrypt í•´ì‹œì…ë‹ˆë‹¤.
admin:$2y$05$7ZOzW4UT3h1kGeJyO/tk..be7mG6D9z8Yb6Skz5iX9d6iCxlAtG7a

request_recëŠ” ì•„íŒŒì¹˜(Apache) HTTP ì„œë²„ì—ì„œ í˜„ì¬ ë“¤ì–´ì˜¨ ìš”ì²­ì— ëŒ€í•œ ëª¨ë“  ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” ì¤‘ìš”í•œ êµ¬ì¡°ì²´ì…ë‹ˆë‹¤. ëª¨ë“ˆì´ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ ì¸ìë¡œ ì „ë‹¬ë˜ë©°, ìš”ì²­ì˜ í’€(pool), ì—°ê²°(connection), ê°€ìƒ í˜¸ìŠ¤íŠ¸(server), íŒŒì¼ ê²½ë¡œ(filename), ìš”ì²­ URI(the_request), í•¸ë“¤ëŸ¬ ì´ë¦„(handler), ì½˜í…ì¸  ìœ í˜•(content_type) ë“± ë‹¤ì–‘í•œ ì •ë³´ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤. 
ì£¼ìš” êµ¬ì„± ìš”ì†Œ:
apr_pool_t *pool: ìš”ì²­ê³¼ ê´€ë ¨ëœ ë©”ëª¨ë¦¬ í’€ì„ ê°€ë¦¬í‚µë‹ˆë‹¤. 
conn_rec *connection: í´ë¼ì´ì–¸íŠ¸ì™€ì˜ ì—°ê²° ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” êµ¬ì¡°ì²´ì— ëŒ€í•œ í¬ì¸í„°ì…ë‹ˆë‹¤. 
server_rec *server: ì´ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ê°€ìƒ í˜¸ìŠ¤íŠ¸(ê°€ìƒ ì„œë²„) ì •ë³´ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤. 
char *the_request: ìš”ì²­ ì¤„ì˜ ì›ë³¸ ë¬¸ìì—´(ì˜ˆ: "GET /path HTTP/1.1")ì„ í¬í•¨í•©ë‹ˆë‹¤. 
char *filename: ìš”ì²­ëœ ë¬¸ì„œì˜ íŒŒì¼ ê²½ë¡œë¥¼ í¬í•¨í•©ë‹ˆë‹¤. 
char *handler: ì´ ìš”ì²­ì„ ì²˜ë¦¬í•  í•¸ë“¤ëŸ¬ ì´ë¦„ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
char *content_type: ìš”ì²­ì´ë‚˜ ì‘ë‹µì˜ ì½˜í…ì¸  ìœ í˜•ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤ (ì˜ˆ: "text/html"). 
ap_method_mask_t allowed: í—ˆìš©ëœ HTTP ë©”ì„œë“œ(GET, POST ë“±)ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. 
í™œìš© ì˜ˆì‹œ:
ëª¨ë“ˆì€ request_rec êµ¬ì¡°ì²´ë¥¼ í†µí•´ ìš”ì²­ì˜ URIë¥¼ ê°€ì ¸ì™€ mod_rewriteì™€ ê°™ì€ ëª¨ë“ˆì—ì„œ ì¡°ê±´ë¶€ ë¡œì§ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
r->handlerì— í•¸ë“¤ëŸ¬ ì´ë¦„ì„ ì§€ì •í•˜ì—¬ íŠ¹ì • ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
r->content_typeì„ ì„¤ì •í•˜ì—¬ ì‘ë‹µ ì½˜í…ì¸  ìœ í˜•ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 


ë””ë ‰í† ë¦¬ êµ¬ì¡°
week12/
 â”œâ”€ docker-compose.yml
 â”œâ”€ apache/
 â”‚   â”œâ”€ Dockerfile
 â”‚   â”œâ”€ vulnerable.conf
 â”‚   â””â”€ .htpasswd
 â””â”€ php/
     â”œâ”€ config.php
     â”œâ”€ index.php
     â”œâ”€ secret.php
     â”œâ”€ test.php
     â””â”€ upload.php


admin password md5 ì•”í˜¸ ìƒì„±
htpasswd -nbm admin password
admin:$apr1$dK.3hx.o$mKyyIrHIyaZscutIquuko/


docker rm -f confusion
docker build -t week12-confusion .
docker run -d -p 8080:80 --name confusion week12-confusion


docker-compose down -v
docker-compose up --build

docker-compose build --no-cache && docker-compose up -d

docker-compose build --no-cache
docker-compose up -d

ë‹¤ ì´ˆê¸°í™” í•˜ê³  ë¹Œë“œ
docker-compose down --volumes --rmi all
docker builder prune -a -f
docker-compose build --no-cache
docker-compose up -d